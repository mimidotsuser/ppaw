<div class="container-fluid">

  <div class="d-flex justify-content-between align-items-center my-3 flex-wrap-reverse gap-2">
    <div class="col-sm-6 col-md-3 data-filters">
      <input type="text" class="form-control search" placeholder="Filter"
             [formControl]="searchControl">
    </div>

    <div class="d-md-block">
      <button type="button" class="btn btn-outline-primary"
              (click)="showCreateForm()" *can="'customers.create'">
        + New Client
      </button>
    </div>

  </div>

</div>
<div class="container-md-fluid">
  <table class="table table-hover table-block-sm">
    <thead>
    <tr>
      <th>Name</th>
      <th>Branch</th>
      <th>Region</th>
      <th>Location</th>
      <th></th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let customer of customers|slice:tableCountStart:tableCountEnd">

      <td>
        <span class="td-inline-label">Name</span>
        {{customer.name}}
      </td>
      <td>
        <span class="td-inline-label">Branch</span>
        {{customer.branch}}
      </td>
      <td>
        <span class="td-inline-label">Region</span>
        {{customer.region}}
      </td>
      <td>
        <span class="td-inline-label">Location</span>
        {{customer.location}}
      </td>
      <td>
        <div class="d-flex gap-2 justify-content-end w-100">
          <div ngbDropdown class="d-inline-block">
            <button class="btn btn-outline-secondary hide-dropdown-toggle border-0" id="dp"
                    ngbDropdownToggle>
              <fa-icon [icon]="faEllipsisV"></fa-icon>
            </button>
            <div ngbDropdownMenu aria-labelledby="dp">

              <ng-container *can="'customers.create'">
                <button ngbDropdownItem *ngIf="!customer.parent_id"
                        (click)="showCreateForm(customer)">
                  Add Branch
                </button>
              </ng-container>

              <button ngbDropdownItem (click)="showEditForm(customer)" *can="'customers.edit'">
                Edit
              </button>
              <button ngbDropdownItem (click)="deleteCustomer(customer)" *can="'customers.delete'">
                Delete
              </button>
            </div>
          </div>
        </div>
      </td>
    </tr>
    <ng-container *ngIf="customers.length===0">
      <tr>
        <td class="text-center py-3" colspan="9">
          <ng-container *ngIf="!searchControl.value;else noResults">
            There is no customers.&nbsp;
            <a class="text-decoration-none" (click)="showCreateForm()" *can="'customers.create'">
              Click to add new item
            </a>
          </ng-container>
          <ng-template #noResults>
            No data matching filters criteria
          </ng-template>
        </td>
      </tr>
    </ng-container>
    </tbody>
  </table>
  <div class="pagination-col d-flex justify-content-end w-100 pr-5">
    <pagination [meta]="pagination" (pageChange)="loadCustomers()">
    </pagination>
  </div>
</div>
<app-side-popup [(show)]="showCustomerFormPopup"
                [title]="this.model?.id?'Update Customer Details':'Create New Customer'">

  <app-customer-form [model]="this.model" #clientFormComponent>
    <div class="d-flex gap-2">

      <button type="submit" class="btn btn-primary" *ngIf="!this.model?.id"
              (click)="saveClientForm(clientFormComponent.form)">
        CREATE
      </button>
      <button type="submit" class="btn btn-primary" *ngIf="this.model?.id"
              (click)="saveClientForm(clientFormComponent.form)">
        UPDATE
      </button>
      <button type="button" class="btn btn-cancel"
              (click)="this.closeCustomerFormPopup(clientFormComponent.form)">
        CANCEL
      </button>
    </div>
  </app-customer-form>

</app-side-popup>
